<!DOCTYPE html>
<html>



<head>
    <meta charset="UTF-8">
    <title>选课</title>
    <script src="./js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="./js/jTemplates/jquery-jtemplates.js"></script>
    <link rel="stylesheet" type="text/css" src="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.css"></link>
    <script src="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.js"></script>
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="./js/layui/css/layui.css">
    <link rel="stylesheet" href="./css/adminLogin.css">
    <link rel="stylesheet" href="./css/courses.css">
    <link rel="stylesheet" href="./css/util.css">
</head>
<body class="greyBg">
<div id="container" style="background-color: #6B91B6;">
    <div id="top">
        <div id="school">
        </div>
        <div id="system">
        </div>
        <div id="login_info">
            <div id="img4" style="cursor: pointer;float: right;">
            </div>
            <div class="acade">
                2019300003041 &nbsp;
            </div>
            <div class="acade">
                国家网络安全学院 &nbsp; &nbsp;
            </div>
        </div>
    </div>
    <div id="main_container">
        <div id="header">
            <ul id="menu">
                    <li id="img1" style="cursor: pointer;" onclick="window.location='courses.html';">
                        
                    </li>
                    <li id="img2" style="cursor: pointer;" onclick="window.location='viewScore.html';">

                    </li>
                    <li id="img3" style="cursor: pointer;" onclick="window.location='info.html';">  

                    </li>   
                        
                    
            </ul>
        </div>
        <!--
        <div id="img1" style="cursor: pointer;" onclick="window.location='courses.html';">
        </div>
        <div id="img2" style="cursor: pointer;" onclick="window.location='viewScore.html';">
        </div>
        <div id="img3" style="cursor: pointer;" onclick="window.location='info.html';">
        </div>
        <div id="img4" style="cursor: pointer;">
        </div>
        </div>
        -->
        <div id="content">
            <div id="right-bar" style="float: right;">
                <div id="selectedCourse" class="downList">
                    <div id="listHead"></div>
                    <div id="listContent">
                        <div class="listTitle">
                            上次选中的课程
                        </div>
                        <div style="color: #F00">
                            太惨了 你怎么一次公选都没选中过
                        </div>
                    </div>
                    <div id="listFoot"></div>
                </div>

            </div>
            <div id="left-bar" style="float: left;height: 100%;
    width: 1100px;">
                <div class="title">
                    <span class="titleFont" id="title">选课</span>
                </div>
                <div class="hr"><div class="hhr"></div></div>
                <form style="background-color: white">
                    <fieldset>
                        <div id="searchBox">
                            <span style="display: inline;">课程名&nbsp;</span>
                            <input type="text" id="title" type="text" value="" 
                            placeholder="留空返回全部结果" name="curName" style="display: inline;">
                        
                            <span>教师名&nbsp;</span>
                            <input type="text" id="title" type="text" value="" 
                            placeholder="留空返回全部结果" name="teaName" style="display: inline;">
                            
                            <span style="display: inline;">领域&nbsp;</span>
                            <select name="field" class="input">
                            <option value="0" name="field">全部</option>
                            <option value="1" name="field">社会科学与现代社会</option>
                            <option value="2" name="field">科学精神与生命关怀</option>
                            <option value="3" name="field">中华文化与世界文明</option>
                            <option value="4" name="field">艺术体验与审美鉴赏</option>
                            </select>

                            <span>显示没有余量的课&nbsp;</span>
                            <input type="checkbox" checked="checked" name="full" value="1">
                            <input type="button" class="searchBtb" id="query" value="查询">
                        </div>
                    </fieldset>
                </form>
                <div class="tipInfo i18n" name="lesson_inquireRange">亲爱的同学 趁咱们学校的服务器还没宕机 快来抢课吧</div>
                <div id='result'  style="overflow-y:scroll;overflow-x: hidden;"></div>
                <div class="tableFoot" ></div>
            </div>
            
        </div>

        <!--
        
        <form id="form">
            <fieldset>
                <p style="padding-bottom: 5px">
                课程名 <input type="text" class="form-control" id="title" type="text" value=""
                placeholder="留空返回全部结果" name="curName" style="width: 15% ;display:block;margin-left:auto;margin-right:auto;" ></p>
                <p style="padding-bottom: 5px">
                教师名 <input type="text" class="form-control" id="title" type="text" value=""
                placeholder="留空返回全部结果" name="teaName" style="width: 15%;display:block;margin-left:auto;margin-right:auto;" > </p><br>
                <p style="padding-bottom: 5px">
                星期一<input type="checkbox" checked="checked" value='1' name="day">
                星期二<input type="checkbox" checked="checked" value='2' name="day">
                星期三<input type="checkbox" checked="checked" value='3' name="day">
                星期四<input type="checkbox" checked="checked" value='4' name="day">
                星期五<input type="checkbox" checked="checked" value='5' name="day"> 
                星期六<input type="checkbox" checked="checked" value='6' name="day">
                星期日<input type="checkbox" checked="checked" value='7' name="day"></p><br>
                <p style="padding-bottom: 5px;">
                社会科学与现代社会 <input type="checkbox" checked="checked" name="field" value="1">
                科学精神与生命关怀星期二 <input type="checkbox" checked="checked" name="field" value="2">
                中华文化与世界文明 <input type="checkbox" checked="checked" name="field" value="3">
                艺术体验与审美鉴赏 <input type="checkbox" checked="checked" name="field" value="4"></p><br>
                显示没有余量的课 <input type="checkbox" checked="checked" name="full" value="1">
                <button type="button" id="query" class="btn btn-default">提交</button>
            </fieldset>

        </form>
        -->
        
</div>
</body>



<script src="./js/layui/layui.js" type="text/javascript"> </script>
<script>
            layui.use(['layer'],function () {
                var layer = layui.layer;
            })
            $("#img4").click(function() {
                var loginLoadIndex = layer.load(2);
                //localStorage.clear("token");
                layer.alert("您已退出登录，稍后将跳转至登录界面", {icon: 0});
                setTimeout("window.location.href = './index.html'",3000);
            })
            $(function(){
                $("#table").bootstrapTable({
                        pagination: true,
                        pageSize: 6,
                        pageNumber: 1,
                        smartDisplay: false,
                        onlyInfoPagination:false,
                        sidePagination:"client",
                    });
                console.log(2);
                })
            $(document).ready(function(){
                $.ajax({
                    headers:{
                        'token': localStorage.getItem("token")
                    },
                    url:"http://localhost:8080/courses?field=1,2,3,4&day=1,2,3,4,5,6,7&full=1",
                    type:"get",
                    traditional:true,
                    success:function(ret){
                        $("#result").setTemplateElement("template");
                        $("#result").processTemplate(ret);
                        console.log("success");
                    },
                    error:function(ret,errorInfo,errorObj){
                        if(ret.responseJSON.code=='A0220'){
                            layer.alert("登录已过期，稍后将跳转至登录界面", {icon: 5});
                        }
                        else if(ret.responseJSON.code=='A0301'){
                            layer.alert("您还未登录，稍后将跳转至登录界面", {icon: 5});
                        }
                        else if(ret.responseJSON.code=='A0300'){
                            layer.alert("您无权限查看该页面，稍后将跳转至登录界面", {icon: 5});
                        }
                        setTimeout("window.location.href = './index.html'",3000);
                        console.log(ret.responseJSON.code);
                        console.log(errorInfo);
                        console.log(errorObj);
                    }
                });

            });
            $("#query").click(function(){
                var curName = $("input[name='curName']").val();
                var teaName = $("input[name='teaName']").val();
                var full=0;
                if($("input[name='full']:checked").val()){
                    full=1;
                }
                /*
                var field=[];                 
                $("input[name='field']:checked").each(function(i){field.push(Number($(this).val()))})
                var tmp_field=field.join(",");
                console.log(tmp_field);
                */
                var field=[]; 
                var field_select = $("select[name='field']").val();
                if(field_select == 0){
                    field=[1,2,3,4];
                }
                else{
                    field=[Number(field_select)];
                }
                var day=[];
                //$("input[name='day']:checked").each(function(i){day.push(Number($(this).val()))})
                day=[1,2,3,4,5,6,7];
                var tmp_day=day.join(",");
                var tmp_field=field.join(",");
                console.log(curName);
                console.log(teaName);
                console.log(full);
                console.log(tmp_field);
                console.log(tmp_day);
                var title = $("#title").val();
                $.ajax({
                    headers:{
                        'token': localStorage.getItem("token")
                    },
                    url:"http://localhost:8080/courses",
                    type:"get",
                    traditional:true,
                    data:{
                        'curName':curName,
                        'teaName':teaName,
                        'field':tmp_field,
                        'full':full,
                        'day':tmp_day,
                    },
                    success:function(ret){
                        console.log(ret);
                        if(ret.length==0){
                            layer.alert("未找到结果", {icon: 0});
                        }
                        else{
                            $("#result").setTemplateElement("template");
                            $("#result").processTemplate(ret);
                            console.log("success");
                        }
                    },
                    error:function(ret,errorInfo,errorObj){
                        alert("哎呀！出错辽QAQ");
                        console.log(errorInfo);
                        console.log(errorObj);
                    }
                });
            });     
            $("#img4").click(function() {
                var loginLoadIndex = layer.load(2);
                localStorage.clear("token");
                layer.alert("您已退出登录，稍后将跳转至登录界面", {icon: 0});
                setTimeout("window.location.href = './index.html'",3000);
            })
            function xuanke(self) {
                var cid = self.value;
                console.log(cid);
                $.ajax({
                    headers:{
                        'token': localStorage.getItem("token")
                    },
                    url:"http://localhost:8080/courses/choose",
                    data:{
                        'cid':cid,
                    },
                    type:"get",
                    traditional:true,
                    success:function(ret){
                        layer.alert("选课成功，稍后页面将自动刷新", {icon: 1});
                        console.log("success");
                        setTimeout("location.reload()",3000);
                    },
                    error:function(ret,errorInfo,errorObj){
                        layer.alert("选课状态已更新，稍后页面将自动刷新", {icon: 0});
                        setTimeout("location.reload()",3000);
                        console.log(ret);
                        console.log(errorInfo);
                        console.log(errorObj);
                    }

                });
            }
        </script>

<textarea id="template" class="template" name="hide" style="display:none;">
        <table class="table table-striped pagination table-bordered" id="table" border="0"  pagination=true  sidePagination="client" pageSize=6 >
            <thead>
                <tr>
                    <th bgcolor="cdd8ea">课程名</th>
                    <th bgcolor="cdd8ea">剩余/最大人数</th>
                    <th bgcolor="cdd8ea">学分</th>
                    <th bgcolor="cdd8ea">教师名</th>
                    <th bgcolor="cdd8ea">领域</th>
                    <th bgcolor="cdd8ea">上课时间</th>
                    <th bgcolor="cdd8ea">备注</th>
                    <th bgcolor="cdd8ea">选课</th>
                    <!--
                    <th>上课日</th>
                    <th>节次</th>
                    <th>周数</th>
                    <th>上课周次</th>
                    
                    -->
                </tr>

            </thead>
            <tbody>
                {#foreach $T as item}
                <tr>
                    <td>
                        <div style="width: 150px">{$T.item.curname}</div>
                    </td>
                    
                    <td>
                        <div style="width: 100px">
                         {#if $T.item.nowremain>=0}
                            <font color="red">{$T.item.nowremain}</font>
                        {#else}
                            <font color="black">{$T.item.nowremain}</font>
                        {#/if}
                        <font color="black">/{$T.item.maxremain}</font>
                        </div>
                    </td>
                    <td>
                        <div style="width: 50px">{$T.item.credit}.0</div>
                    </td>
                    <td>
                        <div style="width: 100px">{$T.item.teaname}</div>
                    </td>
                    <td>
                        <div style="width: 120px">{$T.item.field}</div>
                    </td>
                    <!--
                    <td>
                        <div style="width: 100px">{$T.item.day}</div>
                    </td>
                    <td>
                        <div style="width: 50px">{$T.item.startsection}-{$T.item.endsection}节</div>
                    </td>
                    <td>
                        <div style="width: 50px">{$T.item.startweek}-{$T.item.endweek}周</div>
                    </td>
                    <td>
                        <div style="width: 80px">{$T.item.weeklytimes}</div>
                    </td>
                    -->
                    <td>
                        <div style="width: 200px">{$T.item.day}:{$T.item.startweek}-{$T.item.endweek}周,每{$T.item.weeklytimes}周{$T.item.startsection}-{$T.item.endsection}节</div>
                    </td>
                    
                    <td>
                        <div style="width: 80px">无</div>
                    </td>
                    <td>
                        <div style="width: 150px">
                            {#if $T.item.choose==true}
                            <button id="choose" type="button" class="btn i18n-input" selectname="lesson_select" value="{$T.item.id}" title="已选课" disabled="">选课</button>
                            {#else}
                                {#if $T.item.nowremain==0}
                                <button id="choose" type="button" class="btn i18n-input" selectname="lesson_select" value="{$T.item.id}" title="没有剩余了" disabled="">选课</button>
                                {#else}
                                <button id="choose" type="button" class="btn i18n-input" selectname="lesson_select" value="{$T.item.id}" title="选课暂未开放，请在通知的时间段内选课！" onclick="xuanke(this)">选课</button>
                                {#/if}
                            {#/if}
                        </div>
                    </td>
                </tr>
                {#/for}
            </tbody>
        </table>

        </textarea>


</html>